---
- name: Add the user {{ run.user }}
  ansible.builtin.user:
    name: "{{ run.user }}"
    comment: Specified Run User
    groups: root
    append: true

- name: Create /etc/{{ app.title }} if it does not exist
  ansible.builtin.file:
    path:  "/etc/{{ app.title }}"
    state: directory
    mode: '0755'
    owner: "{{ run.user }}"
    group: "{{ run.user }}"

- name: Create /opt/{{ app.title }} if it does not exist
  ansible.builtin.file:
    path:  "/opt/{{ app.title }}"
    state: directory
    mode: '0755'
    owner: "{{ run.user }}"
    group: "{{ run.user }}"

- name: Create /opt/matterbridge if it does not exist
  ansible.builtin.file:
    path:  /opt/matterbridge
    state: directory
    mode: '0755'
    owner: "{{ run.user }}"
    group: "{{ run.user }}"  

- name: Create a symbolic link for etc for convenience
  ansible.builtin.file:
    dest: "/opt/{{ app.title }}/etc"
    src: "/etc/{{ app.title }}"
    owner: "{{ run.user }}"
    group: "{{ run.user }}"
    state: link
